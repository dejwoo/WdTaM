extends ../layout


append head
    link(type='text/css' rel='stylesheet' href='/stylesheets/mechanic_main.css' media='all')

append foot
    script(src='/js/materialbox.js', type='text/javascript')


block content
    - var lipsum = "Curabitur non ex feugiat, consequat diam at, fermentum purus. Maecenas tincidunt faucibus mattis. Vivamus non nibh vitae justo dignissim luctus at et leo. Nam tristique porta elit. Donec gravida ex eget quam ultricies, vel commodo nisi venenatis. Morbi eget magna at lorem blandit fringilla eget at metus. Maecenas dapibus rutrum odio vel placerat. Nam tortor ante, mollis quis volutpat ut, tincidunt eu augue. Pellentesque sodales consectetur lorem eget pretium."
    - var temp_date = moment(new Date('1.12.2016'));
    - var humanize_setting = {conjunction: ' and ',serialComma: false};
    -
        var messages = [
        {title: "Message 1", author:{firstName:'Robert',lastName:'Tester', isMechanic:false}, createdate:temp_date.subtract(1,'day'), messageContent:lipsum},
        {title: "Message 1", author:{firstName:'Robert',lastName:'Tester', isMechanic:true}, createdate:temp_date.subtract(1,'day'), messageContent:lipsum},
        {title: "Message 1", author:{firstName:'Robert',lastName:'Tester', isMechanic:false}, createdate:temp_date.subtract(1,'day'), messageContent:lipsum,
        images:["media/usr_001/ticket_0123_img_1.jpg","media/usr_001/ticket_0123_img_2.jpg","media/usr_001/ticket_0123_img_3.jpg"]},
        {title: "Message 1", author:{firstName:'Robert',lastName:'Tester', isMechanic:true}, createdate:temp_date.subtract(1,'day'), messageContent:lipsum},
        {title: "Message 1", author:{firstName:'Robert',lastName:'Tester', isMechanic:false}, createdate:temp_date.subtract(1,'day'), messageContent:lipsum,
        images:["media/usr_001/ticket_0123_img_1.jpg","media/usr_001/ticket_0123_img_2.jpg","media/usr_001/ticket_0123_img_3.jpg"]}]


        var messages2 = [
        {
            title: "Car problem",
            author: {
                firstName:'Robert',
                lastName:'Tester',
                isMechanic:false
            },
            createdate:temp_date.subtract(0,'day'),
            messageContent:"Thank you very much Yohan, you've saved my business! You guys fixed it so fast, that I can't be more thankful... I've never seen such talented people. If I experience some more problems with the engine I will send you a message, but for now it works like a charm. Cheers! "
        },
        {
            title: "Message 1",
            author: {
                firstName:'Yohan',
                lastName:'Schmidt',
                isMechanic:true
            },
            createdate:temp_date.subtract(1,'day'),
            messageContent:"That's really sad. I will check if we have it in stock, so we can replace it with the engine, " +
            "but usually we have plenty of these for cars like yours, so no worries. We will be waiting for you at 4 PM."
        },
        {
            title: "Message 1",
            author: {
                firstName:'Robert',
                lastName:'Tester',
                isMechanic:false
            },
            createdate:temp_date.subtract(1,'day'),
            messageContent:"That's really great! Yes, I will come at 4 PM, is that okay with you? And yeah... Some drunken people broke my side window in the morning, is it possible to replace it while fixing the engine?",
            images:["media/usr_001/ticket_0123_img_3.jpg"]
        },
        {
            title: "Message 1",
            author: {
                firstName:'Yohan',
                lastName:'Schmidt',
                isMechanic:true
            },
            createdate:temp_date.subtract(1,'day'),
            messageContent:"Hello, it looks like there's a problem with the turbo. You have to come here, so we can diagnose the exact problem. We can make the diagnostic pretty fast, so will tell you then" +
            " how serious the problem really is. If you need the car for your business and we can't fix it that day, we provide you our car for the days we're working on yours. Can you come today afternnon?"
        },
        {
            title: "Message 1",
            author: {
                firstName:'Robert',
                lastName:'Tester',
                isMechanic:false
            },
            createdate:temp_date.subtract(1,'day'),
            messageContent:"Hello, I have a problem with my car. Whenever I start the engine, it sounds really bad. I mean it lasts during the whole car ride and it also can't go fast now, I can have my foot on the floor and it won't go faster than 80kph. " +
            "I've tried to open the mask, but can't really hear the exact part where it is coming from. I mean, I don't know what to do now. I need my car for my business every day, so I hope it is not something serious. Could you help me with this, please?",
            images:["media/usr_001/ticket_0123_img_1.jpg","media/usr_001/ticket_0123_img_2.jpg"]
        }]

    .parent
        .content-panel
                main.main-content
                    .container-fluid.row
                        ul.collapsible.show-first.popout(data-collapsible='accordion')
                            each item, index in messages2
                                li.detail-card
                                    - var side = item.author.isMechanic?"right": "left"
                                    div(class="collapsible-header" + " message-card-header-" + side)
                                        i.material-icons message
                                        if index == 0
                                            = "Newest Message"
                                        else if index == messages.length - 1
                                            = item.title
                                        else
                                            = 'Re:'.repeat(messages.length - 1 - index) + item.title
                                    .collapsible-body: .card-content
                                        .row
                                            - var temp = item.images? "col s12 m6 l7 "+ side :"col s12 m8 l8 "+ side;
                                            div(class=temp)
                                                div(class="row" + " message-header-" + side)
                                                    span.profile-letter-circle(data-letters=item.author.firstName.charAt(0) + item.author.lastName.charAt(0))
                                                    div
                                                        p.message-author
                                                            = "Written by " + item.author.firstName + " " + item.author.lastName
                                                        p.message-date
                                                            time(datetime=item.createdate.format())="On " + item.createdate.format('Do MMMM YYYY, h:mm')
                                                    if side == "left" && index == 0
                                                        a.show-reply-form.btn.light-blue(href="#") Reply
                                                .row.message-content
                                                    =item.messageContent
                                            if item.images
                                                .col.s12.m4.l5
                                                    .image-grid
                                                        each image in item.images
                                                            .grid-float
                                                                img.message-img.materialboxed(src=image alt data-original=image)
                                        .row.message-reply.hidden-el
                                            .col.s12.left-column
                                                .card
                                                    .card-title
                                                        p Reply message
                                                    .card-content
                                                        .input-field
                                                            textarea.materialize-textarea(id="reply-textarea" length="1024")
                                                            label(for="reply-textarea") Write message...
                                                        a.btn.btn-small.waves-effect.waves-light.light-blue(href='#') Send
                                                        a.hide-reply-form.btn.offset-3.light-blue(href="#onCancelModal") Cancel
                                            .col.s12.right-column
                                                .card
                                                    table.bordered.highlight.card-content.responsive-table
                                                        thead
                                                            tr
                                                                th
                                                                th.tooltipped(data-field='name' data-position="top" data-delay="50" data-tooltip="Service or Product used or planned") Procedure Name
                                                                th.tooltipped(data-field='time' data-position="top" data-delay="50" data-tooltip="Estimated time for the task completition") Est. Time required
                                                                th.tooltipped(data-field='price' data-position="top" data-delay="50" data-tooltip="Estimated price for the task") Est. Price
                                                        tbody
                                                            -
                                                                var expenses = [
                                                                {name:"Product 1", est_time:{hours:1, minutes:30}, est_cost:7.99},
                                                                {name:"Service 2", est_time:{hours:3, minutes:40}, est_cost:15.99},
                                                                {name:"Product 3", est_time:{hours:1}, est_cost:5.99}];

                                                            each item in expenses
                                                                tr
                                                                    td.center: a.delete-table-row(href='#!'): i.material-icons delete
                                                                    td
                                                                        .input-field.custom-input-field
                                                                            label
                                                                                input(value=item.name type=text)
                                                                    td= humanizeDuration(moment.duration(item.est_time), humanize_setting)
                                                                    td= numeral(item.est_cost).format('$ 0,0[.]00')
                                                            tr.add-new-line-row
                                                                td.center
                                                                    button.btn.right.btn-floating.waves-effect.waves-light.grey.add-new-line-button(href='#!')
                                                                        i.material-icons.add-new-line-button-inner add
                                                                td
                                                                td
                                                                td
                                                            tr
                                                                td.center Total
                                                                    -
                                                                        var time_sum = expenses.map(function(i){return i.est_time}).reduce(function(a,b){var t=a;if (!a.isDuration){t=moment.duration(a)}; t.add(moment.duration(b));return t});
                                                                        var cost_sum = expenses.map(function(i){return i.est_cost}).reduce(function(a,b){return a+b});
                                                                td
                                                                td= humanizeDuration(time_sum, humanize_setting)
                                                                td= numeral(cost_sum).format('$ 0,0[.]00')
                    //Modal Structure
                    .modal#onCancelModal
                        .modal-content
                            h4 Cancel Reply
                            p Do you want to really cancel the reply? All edits will be lost!
                        .modal-footer
                            a.modal-action.modal-close.waves-effect.waves-red.btn-flat(href="#!") Disagree
                            a.modal-action.modal-close.waves-effect.waves-green.btn-flat#modalAgree(href="#!") Agree
        include ../includes/footer








